<script>
    // Update year
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    
    // Base de dados de cursos
    const CURSOS_DB = {
        'data-scientist': {
            'Iniciante': [
                {titulo: 'Introdução ao Python', instrutor: 'TéoMeWhy', badge: 'Python', link: 'https://www.youtube.com/watch?v=OeKzVjiiRm4&list=PLvlkVRRKOYFSpRkqnR0p2A-eaVlpLnN3D'},
                {titulo: 'Pandas', instrutor: 'TéoMeWhy', badge: 'Dados', link: 'https://www.youtube.com/watch?v=9Cw7iIjFlBc&list=PLvlkVRRKOYFQHnDhjTmXLEz3HU5WTgOcF'},
                {titulo: 'Estatística Básica', instrutor: 'TéoMeWhy', badge: 'Stats', link: 'https://www.youtube.com/watch?v=4CcgZXXIl7o&list=PLvlkVRRKOYFQGIZdz7BycJet9OncyXlbq'},
                {titulo: 'SQL', instrutor: 'TéoMeWhy', badge: 'SQL', link: 'https://www.youtube.com/watch?v=VmkJG8awKqM&list=PLvlkVRRKOYFRo651oD0JptVqfQGDvMi3j'},
                {titulo: 'Machine Learning pt.1', instrutor: 'TéoMeWhy', badge: 'ML', link: 'https://www.youtube.com/watch?v=oz_rZ92Tmls&list=PLvlkVRRKOYFR6_LmNcJliicNan2TYeFO2'},
                {titulo: 'Machine Learning pt.2', instrutor: 'TéoMeWhy', badge: 'ML', link: 'https://www.youtube.com/watch?v=oj0ACpEHpS0&list=PLvlkVRRKOYFTXcpttQSZmv1wDg7F3uH7o'},
                {titulo: 'Visualização dos Dados', instrutor: 'ICMCTV', badge: 'DataViz', link: 'https://www.youtube.com/watch?v=BLIosfH2yM0&list=PLt7qVSwRVn5YEIvaMb02IJVKCpauWV-s9'},
                {titulo: 'Streamlit', instrutor: 'TéoMeWhy', badge: 'Web', link: 'https://www.youtube.com/watch?v=JLcEWe7woVk&list=PLvlkVRRKOYFRYA40hJ_V8e_iC5Lu6YPyn'},
                {titulo: 'Git & Github', instrutor: 'TéoMeWhy', badge: 'Git', link: 'https://www.youtube.com/watch?v=84FhNXNWoig&list=PLvlkVRRKOYFQyKmdrassLNxkzSMM6tcSL'},
                {titulo: 'Metodologia Ágil', instrutor: 'D1UP Academy', badge: 'Agile', link: 'https://www.youtube.com/watch?v=-2W_loW_QYw&list=PLoGDMdX4pUAfso0bQWSZFgjEBlr2H9IBU'}
            ],
            'Intermediário': [
                {titulo: 'MLFlow', instrutor: 'TéoMeWhy', badge: 'MLOps', link: 'https://www.youtube.com/watch?v=W8bxk42C9UE&list=PLvlkVRRKOYFQeQEA5Lc0US9i-EK8eGgrs'},
                {titulo: 'Panorama da Estatística', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=wAYB75xEdZQ&list=PL5Dg8nFln2eXGSjEct01QinGi4rrNthQG'},
                {titulo: 'Tipos de Dados', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=hESKcJbMCrI&list=PL5Dg8nFln2eU1g1wzazCDF6jusmWE2nIL'},
                {titulo: 'Probabilidade', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=vzzG3oaZtOA&list=PL5Dg8nFln2eWlB9DLi9drLtPcm5UANcUI'},
                {titulo: 'Teoria de Conjuntos', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=S3_3LSJqgVg&list=PL5Dg8nFln2eVou0YbxuUiYWmjPuxTLAYe'},
                {titulo: 'Valor-p', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=xv79gO5C-SE&list=PL5Dg8nFln2eUTqoWcNSV4AyVEVty_edWS'},
                {titulo: 'Modelo de Regressão', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=21txO7PN9EE&list=PL5Dg8nFln2eUTqoWcNSV4AyVEVty_edWS&index=3'},
                {titulo: 'Inferência Estatística', instrutor: 'Cibele Russo', badge: 'Stats', link: 'https://www.youtube.com/watch?v=JB8Hv8yJsIQ&list=PLt7qVSwRVn5aDu6DW-98cgk7ahkjku1B8&index=2'},
                {titulo: 'Time Series - Conceitos Básicos', instrutor: 'Professor Vinicius Lima', badge: 'Time Series', link: 'https://www.youtube.com/watch?v=rexHHx6Nwec&list=PLubmBFLX1_vgGv4sAUG9O0HUw8NzJqhyD'},
                {titulo: 'Time Series - Decomposição', instrutor: 'Professor Vinicius Lima', badge: 'Time Series', link: 'https://www.youtube.com/watch?v=Ep5x8wZI5v0&list=PLubmBFLX1_vjYSpClZuz0fVY-qkx1tMvC'},
                {titulo: 'Time Series - Suavização', instrutor: 'Professor Vinicius Lima', badge: 'Time Series', link: 'https://www.youtube.com/watch?v=aVm0G0HTetw&list=PLubmBFLX1_vhjQjUG_rXpQ--USd102_ff'},
                {titulo: 'Time Series - ARIMA', instrutor: 'Professor Vinicius Lima', badge: 'Time Series', link: 'https://www.youtube.com/watch?v=gJEkECpgsVg&list=PLubmBFLX1_vhN50OkjdmihVzd3kdYKprw'},
                {titulo: 'Deep Learning', instrutor: 'Dalcimar Casanova', badge: 'Deep Learning', link: 'https://www.youtube.com/watch?v=0VD_2t6EdS4&list=PL9At2PVRU0ZqVArhU9QMyI3jSe113_m2-'},
                {titulo: 'Cloud', instrutor: 'Oracle Database', badge: 'Cloud', link: 'https://www.youtube.com/watch?v=ptEmLAoBET8&list=PLdtXkK5KBY57_y3Z0SW2cbCqGUPbfc94w'},
                {titulo: 'APIs (FastAPI)', instrutor: 'Hashtag Programação', badge: 'Web', link: 'https://www.youtube.com/watch?v=Eih-eCCDHW0&list=PLpdAy0tYrnKy3TvpCT-x7kGqMQ5grk1Xq&index=2'}
            ],
            'Avançado': [
                {titulo: 'Estatística Avançada', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=eYvf9ySCWcg&list=PL5Dg8nFln2eVsLUFxlYqjKh4Ps5nW2j1W'},
                {titulo: 'LLMs', instrutor: 'Vizuara', badge: 'LLMs', link: 'https://www.youtube.com/watch?v=Xpr8D6LeAtw&list=PLPTV0NXA_ZSgsLAr8YCgCwhPIJNNtexWu'},
                {titulo: 'Product Management', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=kJwvGhO6BhQ&list=PLXSOhWZ2OouWAyu2nuxz3VP5RZPx3q8uD'},
                {titulo: 'Métricas', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=7cdVqvwArkU&list=PLXSOhWZ2OouWrjuTz-6zrsMRU6wKTC5X2'},
                {titulo: 'Priorização', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=FN0M1EqdTtY&list=PLXSOhWZ2OouVIQSX1Xxt_nD85FkngBu7m'}
            ]
        },
        'data-engineer': {
            'Iniciante': [
                {titulo: 'Introdução ao Python', instrutor: 'TéoMeWhy', badge: 'Python', link: 'https://www.youtube.com/watch?v=OeKzVjiiRm4&list=PLvlkVRRKOYFSpRkqnR0p2A-eaVlpLnN3D'},
                {titulo: 'Pandas', instrutor: 'TéoMeWhy', badge: 'Dados', link: 'https://www.youtube.com/watch?v=9Cw7iIjFlBc&list=PLvlkVRRKOYFQHnDhjTmXLEz3HU5WTgOcF'},
                {titulo: 'SQL', instrutor: 'TéoMeWhy', badge: 'SQL', link: 'https://www.youtube.com/watch?v=VmkJG8awKqM&list=PLvlkVRRKOYFRo651oD0JptVqfQGDvMi3j'},
                {titulo: 'Streamlit', instrutor: 'TéoMeWhy', badge: 'Web', link: 'https://www.youtube.com/watch?v=JLcEWe7woVk&list=PLvlkVRRKOYFRYA40hJ_V8e_iC5Lu6YPyn'},
                {titulo: 'Git & Github', instrutor: 'TéoMeWhy', badge: 'Git', link: 'https://www.youtube.com/watch?v=84FhNXNWoig&list=PLvlkVRRKOYFQyKmdrassLNxkzSMM6tcSL'},
                {titulo: 'APIs (FastAPI)', instrutor: 'Hashtag Programação', badge: 'Web', link: 'https://www.youtube.com/watch?v=Eih-eCCDHW0&list=PLpdAy0tYrnKy3TvpCT-x7kGqMQ5grk1Xq&index=2'},
                {titulo: 'MLFlow', instrutor: 'TéoMeWhy', badge: 'MLOps', link: 'https://www.youtube.com/watch?v=W8bxk42C9UE&list=PLvlkVRRKOYFQeQEA5Lc0US9i-EK8eGgrs'},
                {titulo: 'Metodologia Ágil', instrutor: 'D1UP Academy', badge: 'Agile', link: 'https://www.youtube.com/watch?v=-2W_loW_QYw&list=PLoGDMdX4pUAfso0bQWSZFgjEBlr2H9IBU'}
            ],
            'Intermediário': [
                {titulo: 'Cloud', instrutor: 'Oracle Database', badge: 'Cloud', link: 'https://www.youtube.com/watch?v=ptEmLAoBET8&list=PLdtXkK5KBY57_y3Z0SW2cbCqGUPbfc94w'},
                {titulo: 'Product Management', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=kJwvGhO6BhQ&list=PLXSOhWZ2OouWAyu2nuxz3VP5RZPx3q8uD'},
                {titulo: 'Métricas', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=7cdVqvwArkU&list=PLXSOhWZ2OouWrjuTz-6zrsMRU6wKTC5X2'},
                {titulo: 'Priorização', instrutor: 'Diogo Becker', badge: 'Product', link: 'https://www.youtube.com/watch?v=FN0M1EqdTtY&list=PLXSOhWZ2OouVIQSX1Xxt_nD85FkngBu7m'},
                {titulo: 'Estatística Básica', instrutor: 'TéoMeWhy', badge: 'Stats', link: 'https://www.youtube.com/watch?v=4CcgZXXIl7o&list=PLvlkVRRKOYFQGIZdz7BycJet9OncyXlbq'},
                {titulo: 'Machine Learning pt.1', instrutor: 'TéoMeWhy', badge: 'ML', link: 'https://www.youtube.com/watch?v=oz_rZ92Tmls&list=PLvlkVRRKOYFR6_LmNcJliicNan2TYeFO2'},
                {titulo: 'Machine Learning pt.2', instrutor: 'TéoMeWhy', badge: 'ML', link: 'https://www.youtube.com/watch?v=oj0ACpEHpS0&list=PLvlkVRRKOYFTXcpttQSZmv1wDg7F3uH7o'},
                {titulo: 'Visualização dos Dados', instrutor: 'ICMCTV', badge: 'DataViz', link: 'https://www.youtube.com/watch?v=BLIosfH2yM0&list=PLt7qVSwRVn5YEIvaMb02IJVKCpauWV-s9'}
            ],
            'Avançado': [
                {titulo: 'Panorama da Estatística', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=wAYB75xEdZQ&list=PL5Dg8nFln2eXGSjEct01QinGi4rrNthQG'},
                {titulo: 'Probabilidade', instrutor: 'A Ciência da Estatística', badge: 'Stats', link: 'https://www.youtube.com/watch?v=vzzG3oaZtOA&list=PL5Dg8nFln2eWlB9DLi9drLtPcm5UANcUI'},
                {titulo: 'Deep Learning', instrutor: 'Dalcimar Casanova', badge: 'Deep Learning', link: 'https://www.youtube.com/watch?v=0VD_2t6EdS4&list=PL9At2PVRU0ZqVArhU9QMyI3jSe113_m2-'},
                {titulo: 'LLMs', instrutor: 'Vizuara', badge: 'LLMs', link: 'https://www.youtube.com/watch?v=Xpr8D6LeAtw&list=PLPTV0NXA_ZSgsLAr8YCgCwhPIJNNtexWu'}
            ]
        }
    };
    
    // Mapeamento de filtros para badges (CORREÇÃO AQUI)
    const FILTRO_BADGE_MAP = {
        'Todos': null,
        'Python': ['Python'],
        'Machine Learning': ['ML'],
        'SQL': ['SQL'],
        'Cloud': ['Cloud'],
        'Deep Learning': ['Deep Learning'],
        'Estatística': ['Stats'],
        'APIs': ['Web']
    };
    
    // Função para buscar cursos
    function buscarCursos(termoBusca, filtroTag) {
        const resultados = [];
        const termo = termoBusca.toLowerCase();
        
        // Pegar badges correspondentes ao filtro
        const badgesFiltro = FILTRO_BADGE_MAP[filtroTag] || null;
        
        // Percorrer todas as trilhas e níveis
        Object.keys(CURSOS_DB).forEach(trilhaKey => {
            const trilhaNome = trilhaKey === 'data-scientist' ? 'Cientista de Dados' : 'Engenheiro de Dados';
            
            Object.keys(CURSOS_DB[trilhaKey]).forEach(nivel => {
                CURSOS_DB[trilhaKey][nivel].forEach(curso => {
                    // Verificar filtro de tag
                    if (badgesFiltro && !badgesFiltro.includes(curso.badge)) {
                        return;
                    }
                    
                    // Verificar termo de busca
                    if (termo === '' || 
                        curso.titulo.toLowerCase().includes(termo) ||
                        curso.instrutor.toLowerCase().includes(termo) ||
                        curso.badge.toLowerCase().includes(termo)) {
                        
                        resultados.push({
                            ...curso,
                            trilha: trilhaNome,
                            nivel: nivel
                        });
                    }
                });
            });
        });
        
        return resultados;
    }
    
    // Função para exibir resultados
    function exibirResultados(resultados) {
        const container = document.getElementById('searchResults');
        
        if (resultados.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                    <h3 style="margin-bottom: 1rem;">😕 Nenhum curso encontrado</h3>
                    <p>Tente usar termos diferentes ou remova os filtros</p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div style="margin-bottom: 2rem; text-align: center;">
                <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">
                    ${resultados.length} curso(s) encontrado(s)
                </h3>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
        `;
        
        resultados.forEach(curso => {
            const nivelEmoji = {
                'Iniciante': '🎯',
                'Intermediário': '🚀',
                'Avançado': '💎'
            };
            
            html += `
                <div class="course-node" style="background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);">
                    <span class="node-badge">${curso.badge}</span>
                    <div class="node-header">
                        <h3 class="node-title">${nivelEmoji[curso.nivel]} ${curso.titulo}</h3>
                    </div>
                    <div class="node-meta">
                        <span>📹</span> ${curso.instrutor}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--primary-purple); font-weight: 600; margin: 0.5rem 0;">
                        ${curso.trilha} • ${curso.nivel}
                    </div>
                    <a href="${curso.link}" target="_blank" class="node-link">
                        Acessar →
                    </a>
                </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    // Event listeners para busca
    const searchButton = document.querySelector('.search-button');
    const searchInput = document.querySelector('.search-input-large');
    const filterTags = document.querySelectorAll('.filter-tag');
    
    let filtroAtivo = 'Todos';
    
    // Função de busca
    function performSearch() {
        const termoBusca = searchInput ? searchInput.value : '';
        const resultados = buscarCursos(termoBusca, filtroAtivo);
        exibirResultados(resultados);
    }
    
    // Botão de busca
    if (searchButton) {
        searchButton.addEventListener('click', performSearch);
    }
    
    // Enter no input
    if (searchInput) {
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    }
    
    // Filtros por tag
    filterTags.forEach(tag => {
        tag.addEventListener('click', function() {
            // Remover active de todos
            filterTags.forEach(t => t.classList.remove('active'));
            // Adicionar active no clicado
            this.classList.add('active');
            // Atualizar filtro
            filtroAtivo = this.textContent.trim();
            // Buscar novamente
            performSearch();
        });
    });
    
    // Page navigation
    function showPage(pageId) {
        const pages = document.querySelectorAll('.page');
        pages.forEach(page => page.classList.remove('active'));
        
        const selectedPage = document.getElementById(pageId);
        if (selectedPage) {
            selectedPage.classList.add('active');
        }
        
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => link.classList.remove('active'));
        
        const activeLink = Array.from(navLinks).find(link => {
            const linkText = link.textContent.trim();
            if (pageId === 'home' && linkText === 'Início') return true;
            if (pageId === 'search' && linkText.includes('Pesquisar')) return true;
            if (pageId === 'data-scientist' && linkText.includes('Cientista')) return true;
            if (pageId === 'data-engineer' && linkText.includes('Engenheiro')) return true;
            if (pageId === 'data-manager' && linkText.includes('Gestor')) return true;
            return false;
        });
        
        if (activeLink) {
            activeLink.classList.add('active');
        }
        
        window.scrollTo(0, 0);
    }
    
    // Initialize
    showPage('home');
</script>
